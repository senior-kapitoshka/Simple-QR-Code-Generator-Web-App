#define TWENTY_ONE 21
#include <stdlib.h>
#include <stdio.h>

int** fillMx( const char* qr_code, size_t n){
    int mxTemplate[TWENTY_ONE][TWENTY_ONE]={{1,1,1,1,1,1,1,0,1,2,2,2,2,0,1,1,1,1,1,1,1},
                                    {1,0,0,0,0,0,1,0,0,2,2,2,2,0,1,0,0,0,0,0,1},
                                    {1,0,1,1,1,0,1,0,0,2,2,2,2,0,1,0,1,1,1,0,1},
                                    {1,0,1,1,1,0,1,0,1,2,2,2,2,0,1,0,1,1,1,0,1},
                                    {1,0,1,1,1,0,1,0,0,2,2,2,2,0,1,0,1,1,1,0,1},
                                    {1,0,0,0,0,0,1,0,0,2,2,2,2,0,1,0,0,0,0,0,1},
                                    {1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,1},
                                    {0,0,0,0,0,0,0,0,0,2,2,2,2,0,0,0,0,0,0,0,0},
                                    {0,0,1,0,1,1,1,0,1,2,2,2,2,1,0,0,0,1,0,0,1},
                                    {2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {2,2,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,1,1,1,1,1,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,0,0,0,0,0,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,0,1,1,1,0,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,0,1,1,1,0,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,0,1,1,1,0,1,0,1,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,0,0,0,0,0,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2},
                                    {1,1,1,1,1,1,1,0,0,2,2,2,2,2,2,2,2,2,2,2,2}};

    size_t x=20;
    size_t y=20;
        char flag=1;
        int flag2=2;
        char flag3=0;
        for(size_t i = 0 ; i < n;){
            if(mxTemplate[x][y] == 2){
                if((x+y)%2==0){
                    mxTemplate[x][y]= qr_code[i]=='0'? 1 :0;
                }else{
                    mxTemplate[x][y]= qr_code[i]=='0'? 0 :1;
                }
                ++i;
            }
            if(x==0 || x == 20){
                if(flag2 < 3){
                    if(y != 7){
                        --y;
                        ++flag2;
                    }else{
                        y -= 2;
                        ++flag2;
                        flag3 = 1;
                    }
                }else{
                    flag = !flag;
                    if(flag){
                        ++y;
                        ++x;
                    }else if(!flag){
                        ++y;
                        --x;
                    }
                    flag2 = 0;
                }
            }else{
                if(!flag){
                    if(!flag3){
                        if( y%2 == 0){
                            --y;
                        }else{
                            ++y;
                            --x;
                        }
                    }else{
                        if(y%2 != 0){
                            --y;
                        }else{
                            ++y;
                            --x;
                        }
                    }
                }else if(flag){

                    if(!flag3){
                        if(y%2 == 0){
                            --y;
                        }else{
                            ++x;
                            ++y;
                        }
                    }else{
                        if(y%2 != 0){
                            --y;
                        }else{
                            ++x;
                            ++y;
                        }
                    }
                }
            }
        }
        return mxTemplate;
    }